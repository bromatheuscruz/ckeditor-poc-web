<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./style.css">
    <title>POC - Comments</title>
</head>

<body>
    <div class="container-fluid m-3 p-5">
        <h1 class="text-center">Proof of Concept</h1>
        <div class="text-center">
            <a href="https://ckeditor.com/docs/ckeditor5/latest/index.html" class="btn btn-outline-primary">CKEditor
                5</a>
        </div>
        <div class="row mt-5" style="justify-content: center;">
            <div class="col-xs-12">
                <a href="./comments.html" class="btn btn-link">Comments</a>
                <a href="./mention.html" class="btn btn-link">Mention</a>
                <a href="./parameterized.html" class="btn btn-link">Parameterized</a>
            </div>
        </div>
    </div>
    <div class="container mt-5">
        <h2>Comments Feature</h2>
        <div class="row my-2">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header text-center">
                            Custom Comments
                        </div>
                        <div class="card-body">
                            <div class="container" id="comment-person"></div>
                        </div>
                        <div class="card-footer text-center">
                            <a href="#" class="btn btn-success btn-sm">Resolved</a>
                            <a href="#" class="btn btn-warning btn-sm">On Hold</a>
                            <button class="btn btn-danger btn-sm" id="discard-button">Discard</button>
                            <a href="#" class="btn btn-primary btn-sm">Answer</a>
                        </div>
                    </div>
                </div>
            </div>
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header text-center">
                        CKEditor 5 Comments
                    </div>
                    <div class="card-body">
                        <div id="comment-editor-sidebar"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        Comments Feature
                    </div>
                    <div class="card-body">
                        <div id="comment-editor"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="./bundle.js"></script>
    <script src="./index.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
        let appData = {};

        class CommentsIntegration {

            constructor(editor) {
                this.editor = editor;
            }

            init() {
                const usersPlugin = this.editor.plugins.get('Users');
                const commentsPlugin = this.editor.plugins.get('Comments');

                for (const user of appData.users) {
                    usersPlugin.addUser(user);
                }

                usersPlugin.defineMe(appData.userId);

                for (const commentThread of appData.commentThreads) {
                    commentsPlugin.addCommentThread(commentThread);
                }

                commentsPlugin.adapter = {
                    addComment: (comment) => {
                        const createdAt = new Date();
                        const formattedDate = `${createdAt.getDate()}/${(createdAt.getMonth() + 1)}/${createdAt.getFullYear()}`;
                        comment.date = formattedDate;

                        addCommentToCustomCommentBox(comment);

                        return Promise.resolve({
                            createdAt
                        });
                    },
                    updateComment: () => Promise.resolve(),
                    removeComment: () => Promise.resolve(),

                };
            }
        }

        appData.users = [
            {
                id: 'user-1',
                name: 'Matheus Cruz',
            },
            {
                id: 'user-2',
                name: 'Abraham Lincoln',
            }
        ];
        appData.userId = 'user-1';
        appData.commentThreads = [
            {
                threadId: 'thread-1',
                comments: [
                    {
                        commentId: 'comment-1',
                        authorId: 'user-1',
                        content: '<p>Are we sure we want to use a made-up disorder name?</p>',
                        createdAt: new Date('09/20/2018 14:21:53')
                    },
                    {
                        commentId: 'comment-2',
                        authorId: 'user-2',
                        content: '<p>Why not?</p>',
                        createdAt: new Date('09/21/2018 08:17:01')
                    }
                ]
            }
        ];
        appData.initialData =
            `<h2> <comment id="thread-1" type="start"></comment> Bilingual Personality Disorder <comment id="thread-1" type="end"></comment> </h2> <figure class="image image-style-side"> <img src="https://c.cksource.com/a/1/img/docs/sample-image-bilingual-personality-disorder.jpg"> <figcaption> One language, one person. </figcaption> </figure> <p> This may be the first time you hear about this made-up disorder but it actually isn’t so far from the truth. Even the studies that were conducted almost half a century show that <strong>the language you speak has more effects on you then you realise</strong>. </p><p> One of the very first experiments conducted on this topic dates back to 1964. <a href="https://www.researchgate.net/publication/9440038_Language_and_TAT_content_in_bilinguals">In the experiment</a> designed by linguist Ervin-Tripp who is an expert in psycholinguistic and sociolinguistic studies, adults who are bilingual in English in French were showed series of pictures and were asked to create 3-minute stories. In the end participants emphasized drastically different dynamics for stories in English and French. </p><p> Another ground-breaking experiment which included bilingual Japanese women married to American men in San Francisco were asked to complete sentences. The goal of the experiment was to investigate whether or not human feelings and thoughts are expressed differently in <strong>different language mindsets</strong>. </p><p> Here is a sample from the the experiment: </p><table> <thead> <tr> <th></th> <th>English</th> <th>Japanese</th> </tr></thead> <tbody> <tr> <td>Real friends should</td><td>Be very frank</td><td>Help each other</td></tr><tr> <td>I will probably become</td><td>A teacher</td><td>A housewife</td></tr><tr> <td>When there is a conflict with family</td><td>I do what I want</td><td>It's a time of great unhappiness</td></tr></tbody> </table> <p> More recent <a href="https://books.google.pl/books?id=1LMhWGHGkRUC">studies</a> show, the language a person speaks affects their cognition, behaviour, emotions and hence <strong>their personality</strong>. This shouldn’t come as a surprise <a href="https://en.wikipedia.org/wiki/Lateralization_of_brain_function">since we already know</a> that different regions of the brain become more active depending on the person’s activity at hand. Since structure, information and especially <strong>the culture</strong> of languages varies substantially and the language a person speaks is an essential element of daily life. </p>`;

        const { ClassicEditor: Editor, Watchdog, Mention, Strikethrough, ClassicEditorBase } = ClassicEditor;
        const licenseKey = 'gAneg2iaSnyxkbE+STUwVqPhttKKX9m9EA39S/YEOzz+N7n6q0i3MLc=';

        const watchdog = new Watchdog();
        window.watchdog = watchdog;

        watchdog.setCreator((el, config) => {
            return Editor.create(el, config)
                .then(editor => {
                    editor.plugins.get('CommentsOnly').isEnabled = false;
                    const annotations = editor.plugins.get('Annotations');
                    const sidebarElement = document.getElementById('comment-editor-sidebar');
                    function refreshDisplayMode() {
                        if (window.innerWidth < 1000) {
                            sidebarElement.classList.remove('narrow');
                            sidebarElement.classList.add('hidden');
                            annotations.switchTo('inline');
                        }
                        else if (window.innerWidth < 1300) {
                            sidebarElement.classList.remove('hidden');
                            sidebarElement.classList.add('narrow');
                            annotations.switchTo('narrowSidebar');
                        }
                        else {
                            sidebarElement.classList.remove('hidden', 'narrow');
                            annotations.switchTo('wideSidebar');
                        }
                    }

                    editor.ui.view.listenTo(window, 'beforeunload', (evt, domEvt) => {
                        if (editor.plugins.get('PendingActions').hasAny) {
                            domEvt.preventDefault();
                            domEvt.returnValue = true;
                        }
                    });

                    editor.ui.view.listenTo(window, 'resize', refreshDisplayMode);

                    refreshDisplayMode();

                    return editor;
                });
        });

        watchdog.setDestructor(editor => editor.destroy());

        watchdog.create(document.getElementById('comment-editor'), {
            initialData: appData.initialData,
            extraPlugins: [CommentsIntegration],
            licenseKey,
            sidebar: {
                container: document.getElementById('comment-editor-sidebar')
            }
        });
    </script>
</body>

</html>